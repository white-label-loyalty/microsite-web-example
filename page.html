<!DOCTYPE html>
<html>
  <head>
    <title>Embedded Microsite</title>
    <style>
      iframe {
        margin: 20px auto;
        width: 98%;
        height: 600px;
        border: 1px solid #aaa;
      }
    </style>
  </head>
  <body>
    <h1>Embedding the Microsite</h1>
    <p>Below is an example of how the microsite can be embedded.</p>
    <div id="message">Loading...</div>
    <iframe src=""></iframe>

    <script>
      var eMessage = document.getElementById("message");
      var matches = document.cookie.match(/WLLTOKEN=(.+);?/);
      if (matches && matches[1]) {
        fetch("https://example.staging.web.wlloyalty.net/api/auth", {
          mode: "cors",
          credentials: "include",
          headers: {
            Authorization: `Bearer ${matches[1]}`,
          },
        }).then(() => {
          eMessage.textContent = "Auth complete.";
          document.getElementsByTagName("iframe")[0].src =
            "https://example.staging.web.wlloyalty.net";
        });
      } else {
        eMessage.textContent = "No token provided.";
      }
    </script>
  </body>
</html>
